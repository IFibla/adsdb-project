from models.storage.layers.exploitation import Exploitation
import pandas as pd


class MotorVehicleCollisionsExploitation(Exploitation):
    def _get_trusted_table_names(self) -> list[str]:
        return ["mvc_crash", "mvc_person", "mvc_vehicles"]

    def _get_exploitation_table_name(self) -> str:
        return "motor_vehicle_collisions"

    def _join_tables(self) -> pd.DataFrame:
        dfs = {
            table_name: self.trusted_db_connector.get_table_as_dataframe(table_name)
            for table_name in self._get_trusted_table_names()
        }

        mvc_df = pd.merge(
            dfs["mvc_crash"], dfs["mvc_person"], on="collision_id", how="inner"
        )
        mvc_df = pd.merge(mvc_df, dfs["mvc_vehicles"], on="collision_id", how="inner")
        return mvc_df
