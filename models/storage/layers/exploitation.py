from src.helpers.db_connector import DBConnector
from models.storage.layer import Layer
from abc import abstractmethod
import pandas as pd


class Exploitation(Layer):
    def __init__(
        self, trusted_db_connector: DBConnector, exploitation_db_connector: DBConnector
    ):
        self.trusted_db_connector = trusted_db_connector
        self.exploitation_db_connector = exploitation_db_connector

    @abstractmethod
    def _get_trusted_table_names(self) -> list[str]:
        pass

    @abstractmethod
    def _get_exploitation_table_name(self) -> str:
        pass

    @abstractmethod
    def _join_tables(self, table_names: list[str]) -> pd.DataFrame:
        pass

    def execute(self):
        table_names = self._get_trusted_table_names()
        df = self._join_tables(table_names)
        self.exploitation_db_connector(self._get_exploitation_table_name(), df)
